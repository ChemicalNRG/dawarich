<div class="w-full">
  <% content_for :title, "Visits" %>

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">Visits</h1>
  </div>

  <%= paginate @visits %>

  <ul class="timeline timeline-snap-icon max-md:timeline-compact timeline-vertical">
    <% @visits.each.with_index do |date, index| %>
      <li>
        <div class="timeline-middle">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="<%= date[:visits].all?(&:confirmed?) ? 'green' : 'currentColor' %>"
            class="h-5 w-5">
            <path
              fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z"
              clip-rule="evenodd" />
          </svg>
        </div>
        <div class="<%= index.odd? ? 'timeline-start' : 'timeline-end' %> mb-10 md:text-end">
          <time class="font-mono italic"><%= date[:date].strftime('%A, %d %B %Y') %></time>
          <% date[:visits].each do |visit| %>
            <div class="group relative">
              <div class="flex items-center justify-between">
                <div>
                  <div class="text-lg font-black <%= 'underline decoration-dotted' if visit.pending? %>">
                    <%= visit.area.name %>
                  </div>
                  <div>
                    <%= "#{visit.started_at.strftime('%H:%M')} - #{visit.ended_at.strftime('%H:%M')}" %>
                  </div>
                </div>
                <% if visit.pending? %>
                  <div class="opacity-0 transition-opacity duration-300 group-hover:opacity-100 flex items-center ml-4">
                    <%= button_to 'Confirm', visit_path(visit, 'visit[status]': :confirmed), method: :patch, data: { turbo: false }, class: 'btn btn-xs btn-success mr-1' %>
                    <%= button_to 'Decline', visit_path(visit, 'visit[status]': :declined), method: :patch, data: { turbo: false }, class: 'btn btn-xs btn-error' %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
        <hr />
      </li>
    <% end %>
  </ul>
</div>
